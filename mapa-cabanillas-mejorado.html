<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cultivos de Cabanillas - Simulador Agr√≠cola</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: #1a1a1a;
            height: 100vh;
        }

        /* Viewport principal */
        #viewport {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            position: relative;
            cursor: grab;
        }

        #viewport.dragging {
            cursor: grabbing;
        }

        /* Contenedor del mapa mundo - TAMA√ëO AUMENTADO */
        #worldMap {
            position: absolute;
            width: 7000px;
            height: 5000px;
            background-image: url('assets/images/Fondo.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: transform 0.1s ease-out;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        /* Overlay sutil para mejorar la visibilidad de elementos */
        .map-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.1);
            pointer-events: none;
        }

        /* Grid opcional para ayudar con posicionamiento */
        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                repeating-linear-gradient(0deg, transparent, transparent 99px, rgba(255,255,255,0.03) 99px, rgba(255,255,255,0.03) 100px),
                repeating-linear-gradient(90deg, transparent, transparent 99px, rgba(255,255,255,0.03) 99px, rgba(255,255,255,0.03) 100px);
            pointer-events: none;
            display: none; /* Oculto por defecto */
        }

        /* Zona interactiva base */
        .zone {
            position: absolute;
            border: 4px solid transparent;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.8);
            backdrop-filter: blur(3px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .zone:hover {
            transform: scale(1.05);
            border-color: white;
            box-shadow: 0 0 30px rgba(255,255,255,0.6);
            z-index: 100;
        }

        .zone-icon {
            font-size: 56px;
            margin-bottom: 12px;
            animation: float 3s ease-in-out infinite;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.5));
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }

        .zone-label {
            background: rgba(0,0,0,0.85);
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 18px;
            border: 2px solid rgba(255,255,255,0.2);
        }

        /* Tipos de zonas - colores m√°s vivos */
        .zone.shop {
            background: rgba(255, 165, 0, 0.4);
            border-color: rgba(255, 165, 0, 0.6);
        }

        .zone.shop:hover {
            background: rgba(255, 165, 0, 0.5);
        }

        .zone.crops {
            background: rgba(34, 139, 34, 0.4);
            border-color: rgba(34, 139, 34, 0.6);
        }

        .zone.crops:hover {
            background: rgba(34, 139, 34, 0.5);
        }

        .zone.storage {
            background: rgba(139, 69, 19, 0.4);
            border-color: rgba(139, 69, 19, 0.6);
        }

        .zone.storage:hover {
            background: rgba(139, 69, 19, 0.5);
        }

        .zone.house {
            background: rgba(178, 34, 34, 0.4);
            border-color: rgba(178, 34, 34, 0.6);
        }

        .zone.house:hover {
            background: rgba(178, 34, 34, 0.5);
        }

        /* Minimapa - ACTUALIZADO */
        #minimap {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 420px;
            height: 300px;
            background: rgba(0, 0, 0, 0.85);
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 12px;
            overflow: hidden;
            z-index: 1000;
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
        }

        .minimap-content {
            width: 100%;
            height: 100%;
            position: relative;
            background-image: url('assets/images/Fondo.jpg');
            background-size: cover;
            background-position: center;
            opacity: 0.6;
        }

        .minimap-zone {
            position: absolute;
            border: 2px solid white;
            border-radius: 4px;
            opacity: 0.8;
        }

        .minimap-zone.shop { background: rgba(255, 165, 0, 0.7); }
        .minimap-zone.crops { background: rgba(34, 139, 34, 0.7); }
        .minimap-zone.storage { background: rgba(139, 69, 19, 0.7); }
        .minimap-zone.house { background: rgba(178, 34, 34, 0.7); }

        .minimap-viewport {
            position: absolute;
            border: 3px solid #ffff00;
            background: rgba(255, 255, 0, 0.15);
            pointer-events: none;
            box-shadow: 0 0 10px rgba(255,255,0,0.5);
        }

        /* Controles de navegaci√≥n */
        #controls {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 18px 35px;
            border-radius: 10px;
            color: white;
            z-index: 1000;
            text-align: center;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        #controls h3 {
            margin-bottom: 12px;
            color: #66ff66;
            font-size: 20px;
        }

        #controls p {
            font-size: 14px;
            margin: 6px 0;
            color: #ddd;
        }

        /* Indicador de zona actual */
        #currentZone {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 18px 28px;
            border-radius: 10px;
            color: white;
            z-index: 1000;
            min-width: 220px;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        #currentZone h4 {
            color: #66ff66;
            margin-bottom: 10px;
            font-size: 18px;
        }

        #currentZone p {
            font-size: 15px;
            color: #ccc;
        }

        /* Botones de acci√≥n r√°pida */
        .quick-actions {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 12px;
            z-index: 1000;
        }

        .quick-action-btn {
            width: 65px;
            height: 65px;
            background: rgba(0, 0, 0, 0.85);
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 50%;
            color: white;
            font-size: 26px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }

        .quick-action-btn:hover {
            background: rgba(0, 0, 0, 0.95);
            transform: scale(1.15);
            border-color: white;
            box-shadow: 0 6px 20px rgba(255,255,255,0.3);
        }

        /* Tooltip */
        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 12px 18px;
            border-radius: 8px;
            font-size: 15px;
            pointer-events: none;
            z-index: 10000;
            display: none;
            white-space: nowrap;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 12px rgba(0,0,0,0.6);
        }

        /* Modal de zona */
        .zone-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .zone-modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            padding: 45px;
            border-radius: 20px;
            max-width: 650px;
            width: 90%;
            color: white;
            position: relative;
            animation: slideUp 0.4s ease;
            box-shadow: 0 10px 40px rgba(0,0,0,0.7);
            border: 3px solid rgba(255,255,255,0.2);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(80px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-content h2 {
            color: #66ff66;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 18px;
            font-size: 32px;
        }

        .modal-content .zone-icon {
            font-size: 72px;
            margin: 0;
        }

        .modal-content p {
            line-height: 1.8;
            margin-bottom: 25px;
            font-size: 16px;
            color: #ddd;
        }

        .modal-actions {
            display: flex;
            gap: 18px;
            margin-top: 35px;
        }

        .modal-btn {
            flex: 1;
            padding: 18px 35px;
            border: none;
            border-radius: 10px;
            font-size: 17px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, #4fb3d4 0%, #3da5c4 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(79,179,212,0.4);
        }

        .modal-btn.primary:hover {
            background: linear-gradient(135deg, #3da5c4 0%, #2d95b4 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(79,179,212,0.6);
        }

        .modal-btn.secondary {
            background: #555;
            color: white;
        }

        .modal-btn.secondary:hover {
            background: #666;
            transform: translateY(-2px);
        }

        .close-modal {
            position: absolute;
            top: 18px;
            right: 18px;
            background: transparent;
            border: none;
            color: white;
            font-size: 36px;
            cursor: pointer;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            color: #ff4444;
            transform: rotate(90deg) scale(1.2);
        }

        /* Recursos del jugador */
        #playerResources {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 18px 28px;
            border-radius: 10px;
            color: white;
            z-index: 1000;
            min-width: 220px;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        #playerResources h4 {
            color: #66ff66;
            margin-bottom: 12px;
            font-size: 18px;
        }

        .resource-item {
            display: flex;
            justify-content: space-between;
            margin: 7px 0;
            font-size: 15px;
        }

        .resource-item strong {
            color: #66ff66;
            font-size: 16px;
        }

        /* Zoom controls */
        .zoom-controls {
            position: fixed;
            top: 120px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }

        .zoom-btn {
            width: 55px;
            height: 55px;
            background: rgba(0, 0, 0, 0.85);
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 10px;
            color: white;
            font-size: 26px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }

        .zoom-btn:hover {
            background: rgba(0, 0, 0, 0.95);
            border-color: white;
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(255,255,255,0.3);
        }

        /* T√≠tulo del mapa */
        .map-title {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 15px 40px;
            border-radius: 12px;
            color: white;
            z-index: 900;
            border: 2px solid rgba(255,255,255,0.3);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            text-align: center;
        }

        .map-title h1 {
            font-size: 28px;
            color: #66ff66;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .map-title p {
            font-size: 14px;
            color: #aaa;
        }

        /* Marcadores de parcelas (para cuando se implementen) */
        .crop-plot-marker {
            position: absolute;
            width: 70px;
            height: 70px;
            background: rgba(34, 139, 34, 0.3);
            border: 3px solid rgba(34, 139, 34, 0.6);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none; /* Oculto hasta que se implemente la funcionalidad */
        }
    </style>
</head>
<body>
    <!-- Viewport principal -->
    <div id="viewport">
        <div id="worldMap">
            <!-- Overlay sutil -->
            <div class="map-overlay"></div>
            
            <!-- Grid overlay (opcional, activar con bot√≥n) -->
            <div class="grid-overlay"></div>

            <!-- ZONAS DEL PUEBLO (centro del mapa) -->
            
            <!-- Zona: Tienda - Ubicada en el centro del pueblo -->
            <div class="zone shop" data-zone="shop" style="left: 2500px; top: 1750px; width: 280px; height: 240px;">
                <div class="zone-icon">üè™</div>
                <div class="zone-label">Tienda</div>
            </div>

            <!-- Zona: Casa - Ubicada en el pueblo -->
            <div class="zone house" data-zone="house" style="left: 2800px; top: 1700px; width: 300px; height: 260px;">
                <div class="zone-icon">üè†</div>
                <div class="zone-label">Tu Casa</div>
            </div>

            <!-- Zona: Almac√©n - Ubicada en el pueblo -->
            <div class="zone storage" data-zone="storage" style="left: 2600px; top: 2050px; width: 320px; height: 270px;">
                <div class="zone-icon">üì¶</div>
                <div class="zone-label">Almac√©n</div>
            </div>

            <!-- ZONAS DE CULTIVO (distribuidas por el mapa) -->

            <!-- Zona: Cultivo de Br√≥coli -->
            <div class="zone crops" data-zone="crops_brocoli" style="left: 1200px; top: 800px; width: 600px; height: 500px;">
                <div class="zone-icon">ü•¶</div>
                <div class="zone-label">Cultivo de Br√≥coli</div>
            </div>

            <!-- Zona: Cultivo de Alcachofa -->
            <div class="zone crops" data-zone="crops_alcachofa" style="left: 4500px; top: 1200px; width: 650px; height: 520px;">
                <div class="zone-icon">üåø</div>
                <div class="zone-label">Cultivo de Alcachofa</div>
            </div>

            <!-- Zona: Cultivo de Esp√°rrago -->
            <div class="zone crops" data-zone="crops_esparrago" style="left: 800px; top: 2800px; width: 600px; height: 550px;">
                <div class="zone-icon">üéã</div>
                <div class="zone-label">Cultivo de Esp√°rrago</div>
            </div>

            <!-- Zona: Cultivo de Coliflor -->
            <div class="zone crops" data-zone="crops_coliflor" style="left: 5500px; top: 2500px; width: 700px; height: 600px;">
                <div class="zone-icon">ü•¨</div>
                <div class="zone-label">Cultivo de Coliflor</div>
            </div>

            <!-- Zona: Cultivo de Piparrikas -->
            <div class="zone crops" data-zone="crops_piparrikas" style="left: 2200px; top: 3800px; width: 650px; height: 580px;">
                <div class="zone-icon">ü´ë</div>
                <div class="zone-label">Cultivo de Piparrikas</div>
            </div>

            <!-- Zona: Cultivo de Pimiento Colorao -->
            <div class="zone crops" data-zone="crops_pimiento" style="left: 4800px; top: 600px; width: 620px; height: 500px;">
                <div class="zone-icon">üå∂Ô∏è</div>
                <div class="zone-label">Cultivo de Pimiento Colorao</div>
            </div>

            <!-- Zona: Cultivo de Cogollos de Tudela -->
            <div class="zone crops" data-zone="crops_cogollos" style="left: 1000px; top: 4000px; width: 680px; height: 550px;">
                <div class="zone-icon">ü•ó</div>
                <div class="zone-label">Cultivo de Cogollos de Tudela</div>
            </div>
        </div>
    </div>

    <!-- T√≠tulo del mapa -->
    <div class="map-title">
        <h1>üåæ Cultivos de Cabanillas üåæ</h1>
        <p>Simulador Agr√≠cola - Navarra</p>
    </div>

    <!-- Controles de navegaci√≥n -->
    <div id="controls">
        <h3>üéÆ Controles</h3>
        <p>üñ±Ô∏è Arrastra para mover el mapa | ‚å®Ô∏è WASD / Flechas para navegar</p>
        <p>üîç +/- para zoom | üëÜ Click en zonas para interactuar</p>
    </div>

    <!-- Indicador de zona actual -->
    <div id="currentZone">
        <h4>üìç Ubicaci√≥n</h4>
        <p id="locationText">Explorando Cabanillas...</p>
    </div>

    <!-- Recursos del jugador -->
    <div id="playerResources">
        <h4>üí∞ Recursos</h4>
        <div class="resource-item">
            <span>Semillas:</span>
            <strong id="seedsCount">10</strong>
        </div>
        <div class="resource-item">
            <span>Monedas:</span>
            <strong id="coinsCount">100</strong>
        </div>
        <div class="resource-item">
            <span>Nivel:</span>
            <strong id="levelCount">1</strong>
        </div>
    </div>

    <!-- Controles de zoom -->
    <div class="zoom-controls">
        <button class="zoom-btn" id="zoomIn" title="Acercar">+</button>
        <button class="zoom-btn" id="zoomOut" title="Alejar">‚àí</button>
        <button class="zoom-btn" id="zoomReset" style="font-size: 18px;" title="Resetear zoom">‚äô</button>
    </div>

    <!-- Minimapa -->
    <div id="minimap">
        <div class="minimap-content">
            <!-- Zonas del pueblo -->
            <div class="minimap-zone shop" style="left: 35.7%; top: 35%; width: 4%; height: 4.8%;"></div>
            <div class="minimap-zone house" style="left: 40%; top: 34%; width: 4.3%; height: 5.2%;"></div>
            <div class="minimap-zone storage" style="left: 37.1%; top: 41%; width: 4.6%; height: 5.4%;"></div>

            <!-- Zonas de cultivo -->
            <div class="minimap-zone crops" style="left: 17.1%; top: 16%; width: 8.6%; height: 10%;"></div>
            <div class="minimap-zone crops" style="left: 64.3%; top: 24%; width: 9.3%; height: 10.4%;"></div>
            <div class="minimap-zone crops" style="left: 11.4%; top: 56%; width: 8.6%; height: 11%;"></div>
            <div class="minimap-zone crops" style="left: 78.6%; top: 50%; width: 10%; height: 12%;"></div>
            <div class="minimap-zone crops" style="left: 31.4%; top: 76%; width: 9.3%; height: 11.6%;"></div>
            <div class="minimap-zone crops" style="left: 68.6%; top: 12%; width: 8.9%; height: 10%;"></div>
            <div class="minimap-zone crops" style="left: 14.3%; top: 80%; width: 9.7%; height: 11%;"></div>
            <div class="minimap-viewport"></div>
        </div>
    </div>

    <!-- Botones de acci√≥n r√°pida -->
    <div class="quick-actions">
        <button class="quick-action-btn" id="centerMap" title="Centrar en pueblo">üéØ</button>
        <button class="quick-action-btn" id="toggleGrid" title="Mostrar/Ocultar grid">‚äû</button>
        <button class="quick-action-btn" id="toggleInfo" title="Informaci√≥n del mapa">‚ÑπÔ∏è</button>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <!-- Modal de zona -->
    <div class="zone-modal" id="zoneModal">
        <div class="modal-content">
            <button class="close-modal" id="closeZoneModal">‚úï</button>
            <h2>
                <span class="zone-icon" id="modalIcon">üè™</span>
                <span id="modalTitle">Tienda</span>
            </h2>
            <p id="modalDescription">Descripci√≥n de la zona</p>
            <div class="modal-actions">
                <button class="modal-btn primary" id="enterZone">Entrar a la Zona</button>
                <button class="modal-btn secondary" id="closeModal">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURACI√ìN DEL JUEGO
        // ============================================

        const WORLD_WIDTH = 7000;   // Aumentado para m√°s zonas de cultivo
        const WORLD_HEIGHT = 5000;  // Aumentado para m√°s zonas de cultivo
        const MOVE_SPEED = 20;
        const DRAG_SPEED = 1;
        const MIN_ZOOM = 0.3;
        const MAX_ZOOM = 2;
        const ZOOM_STEP = 0.15;

        // ============================================
        // ESTADO DEL JUEGO
        // ============================================

        const gameState = {
            camera: {
                x: 0,
                y: 0,
                zoom: 0.6  // Zoom inicial m√°s alejado para ver m√°s del mapa
            },
            isDragging: false,
            dragStart: { x: 0, y: 0 },
            keys: {},
            currentZone: null,
            resources: {
                seeds: 10,
                coins: 100,
                level: 1
            }
        };

        // ============================================
        // DATOS DE ZONAS
        // ============================================

        const ZONES_DATA = {
            shop: {
                name: 'Tienda de Cabanillas',
                icon: 'üè™',
                description: 'La tienda del pueblo donde puedes comprar semillas, herramientas y mejoras para tu granja. Un lugar esencial para todo agricultor.',
                action: 'openShop'
            },
            house: {
                name: 'Tu Casa en Cabanillas',
                icon: 'üè†',
                description: 'Tu hogar en el pueblo. Aqu√≠ puedes descansar, mejorar tus habilidades y planificar tu estrategia agr√≠cola.',
                action: 'openHouse'
            },
            storage: {
                name: 'Almac√©n Municipal',
                icon: 'üì¶',
                description: 'El almac√©n donde guardas tus cosechas. Mej√≥ralo para aumentar tu capacidad de almacenamiento.',
                action: 'openStorage'
            },
            crops_brocoli: {
                name: 'Cultivo de Br√≥coli',
                icon: 'ü•¶',
                description: 'Zona de cultivo de br√≥coli. Hortaliza nutritiva de la familia de las cruc√≠feras, perfecta para el clima de Cabanillas.',
                action: 'openCropArea'
            },
            crops_alcachofa: {
                name: 'Cultivo de Alcachofa',
                icon: 'üåø',
                description: '√Årea dedicada al cultivo de alcachofas. Planta tradicional de la huerta navarra, apreciada por su sabor √∫nico.',
                action: 'openCropArea'
            },
            crops_esparrago: {
                name: 'Cultivo de Esp√°rrago',
                icon: 'üéã',
                description: 'Zona especializada en esp√°rragos. Producto de alta calidad, muy valorado en la gastronom√≠a local.',
                action: 'openCropArea'
            },
            crops_coliflor: {
                name: 'Cultivo de Coliflor',
                icon: 'ü•¨',
                description: 'Parcela de coliflor. Hortaliza vers√°til y nutritiva, ideal para el clima de la regi√≥n.',
                action: 'openCropArea'
            },
            crops_piparrikas: {
                name: 'Cultivo de Piparrikas',
                icon: 'ü´ë',
                description: 'Zona de piparrikas (pimientos verdes). Ingrediente esencial de la cocina navarra.',
                action: 'openCropArea'
            },
            crops_pimiento: {
                name: 'Cultivo de Pimiento Colorao',
                icon: 'üå∂Ô∏è',
                description: '√Årea de pimiento colorao (pimiento rojo). Cultivo tradicional con gran sabor y color.',
                action: 'openCropArea'
            },
            crops_cogollos: {
                name: 'Cultivo de Cogollos de Tudela',
                icon: 'ü•ó',
                description: 'Zona de cogollos de Tudela. Lechuga de cogollo famosa por su calidad y frescura, IGP de Navarra.',
                action: 'openCropArea'
            }
        };

        // ============================================
        // ELEMENTOS DEL DOM
        // ============================================

        const viewport = document.getElementById('viewport');
        const worldMap = document.getElementById('worldMap');
        const minimapViewport = document.querySelector('.minimap-viewport');
        const locationText = document.getElementById('locationText');
        const zoneModal = document.getElementById('zoneModal');
        const tooltip = document.getElementById('tooltip');

        // ============================================
        // INICIALIZACI√ìN
        // ============================================

        document.addEventListener('DOMContentLoaded', () => {
            initializeCamera();
            setupEventListeners();
            updateCamera();
            updateMinimap();
            startGameLoop();
            
            // Mensaje de bienvenida
            setTimeout(() => {
                console.log('üåæ ¬°Bienvenido a Cultivos de Cabanillas! üåæ');
                console.log('üìç Explora el mapa interactivo del municipio');
                console.log('üéØ Haz clic en las zonas para interactuar');
            }, 1000);
        });

        function initializeCamera() {
            // Centrar la c√°mara en el pueblo (centro del mapa)
            const centerX = 2700; // Centro aproximado del pueblo
            const centerY = 1900;
            
            gameState.camera.x = -(centerX * gameState.camera.zoom - window.innerWidth / 2);
            gameState.camera.y = -(centerY * gameState.camera.zoom - window.innerHeight / 2);
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================

        function setupEventListeners() {
            // Drag del mapa
            viewport.addEventListener('mousedown', handleDragStart);
            document.addEventListener('mousemove', handleDragMove);
            document.addEventListener('mouseup', handleDragEnd);

            // Teclas de movimiento
            document.addEventListener('keydown', (e) => {
                gameState.keys[e.key.toLowerCase()] = true;

                // Prevenir scroll con flechas
                if(['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                    e.preventDefault();
                }
            });

            document.addEventListener('keyup', (e) => {
                gameState.keys[e.key.toLowerCase()] = false;
            });

            // Zoom con rueda del mouse
            viewport.addEventListener('wheel', handleWheel, { passive: false });

            // Botones de zoom
            document.getElementById('zoomIn').addEventListener('click', () => zoomCamera(ZOOM_STEP));
            document.getElementById('zoomOut').addEventListener('click', () => zoomCamera(-ZOOM_STEP));
            document.getElementById('zoomReset').addEventListener('click', () => {
                gameState.camera.zoom = 0.6;
                updateCamera();
            });

            // Bot√≥n centrar mapa
            document.getElementById('centerMap').addEventListener('click', initializeCamera);

            // Toggle grid
            document.getElementById('toggleGrid').addEventListener('click', () => {
                const grid = document.querySelector('.grid-overlay');
                grid.style.display = grid.style.display === 'none' ? 'block' : 'none';
            });

            // Toggle info
            document.getElementById('toggleInfo').addEventListener('click', () => {
                alert('üó∫Ô∏è Mapa de Cabanillas (Navarra)\n\n' +
                      'üìç Pueblo: Centro del mapa\n' +
                      'üåæ Zonas de cultivo: Alrededor del pueblo\n' +
                      'üè™ Edificios: Tienda, Casa, Almac√©n\n\n' +
                      'Explora todas las √°reas para descubrir oportunidades de cultivo.');
            });

            // Zonas interactivas
            document.querySelectorAll('.zone').forEach(zone => {
                zone.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openZoneModal(zone.dataset.zone);
                });

                zone.addEventListener('mouseenter', (e) => {
                    const zoneData = ZONES_DATA[zone.dataset.zone];
                    showTooltip(e, zoneData.name);
                });

                zone.addEventListener('mouseleave', hideTooltip);
                
                zone.addEventListener('mousemove', (e) => {
                    updateTooltipPosition(e);
                });
            });

            // Modal
            document.getElementById('closeZoneModal').addEventListener('click', closeZoneModal);
            document.getElementById('closeModal').addEventListener('click', closeZoneModal);
            document.getElementById('enterZone').addEventListener('click', enterCurrentZone);

            // Cerrar modal al hacer clic fuera
            zoneModal.addEventListener('click', (e) => {
                if (e.target === zoneModal) closeZoneModal();
            });
        }

        // ============================================
        // SISTEMA DE C√ÅMARA
        // ============================================

        function updateCamera() {
            // Limitar la c√°mara a los bordes del mapa
            const maxX = 0;
            const minX = -(WORLD_WIDTH * gameState.camera.zoom - window.innerWidth);
            const maxY = 0;
            const minY = -(WORLD_HEIGHT * gameState.camera.zoom - window.innerHeight);

            gameState.camera.x = Math.max(minX, Math.min(maxX, gameState.camera.x));
            gameState.camera.y = Math.max(minY, Math.min(maxY, gameState.camera.y));

            // Aplicar transformaci√≥n
            worldMap.style.transform = `
                translate(${gameState.camera.x}px, ${gameState.camera.y}px)
                scale(${gameState.camera.zoom})
            `;

            updateMinimap();
        }

        function zoomCamera(delta) {
            const oldZoom = gameState.camera.zoom;
            gameState.camera.zoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, gameState.camera.zoom + delta));
            
            // Ajustar posici√≥n para hacer zoom hacia el centro
            const zoomRatio = gameState.camera.zoom / oldZoom;
            const centerX = window.innerWidth / 2;
            const centerY = window.innerHeight / 2;
            
            gameState.camera.x = centerX - (centerX - gameState.camera.x) * zoomRatio;
            gameState.camera.y = centerY - (centerY - gameState.camera.y) * zoomRatio;
            
            updateCamera();
        }

        // ============================================
        // CONTROLES DE MOVIMIENTO
        // ============================================

        function handleDragStart(e) {
            if (e.target.classList.contains('zone') || e.target.closest('.zone')) return;

            gameState.isDragging = true;
            gameState.dragStart = {
                x: e.clientX - gameState.camera.x,
                y: e.clientY - gameState.camera.y
            };
            viewport.classList.add('dragging');
        }

        function handleDragMove(e) {
            if (!gameState.isDragging) return;

            gameState.camera.x = e.clientX - gameState.dragStart.x;
            gameState.camera.y = e.clientY - gameState.dragStart.y;

            updateCamera();
        }

        function handleDragEnd() {
            gameState.isDragging = false;
            viewport.classList.remove('dragging');
        }

        function handleWheel(e) {
            e.preventDefault();
            const delta = e.deltaY > 0 ? -ZOOM_STEP : ZOOM_STEP;
            zoomCamera(delta);
        }

        function handleKeyboardMovement() {
            let moved = false;
            const speed = MOVE_SPEED * (1 / gameState.camera.zoom); // Ajustar velocidad seg√∫n zoom

            if (gameState.keys['w'] || gameState.keys['arrowup']) {
                gameState.camera.y += speed;
                moved = true;
            }
            if (gameState.keys['s'] || gameState.keys['arrowdown']) {
                gameState.camera.y -= speed;
                moved = true;
            }
            if (gameState.keys['a'] || gameState.keys['arrowleft']) {
                gameState.camera.x += speed;
                moved = true;
            }
            if (gameState.keys['d'] || gameState.keys['arrowright']) {
                gameState.camera.x -= speed;
                moved = true;
            }

            if (moved) {
                updateCamera();
            }
        }

        // ============================================
        // MINIMAPA
        // ============================================

        function updateMinimap() {
            const scaleX = 420 / WORLD_WIDTH;
            const scaleY = 300 / WORLD_HEIGHT;

            const viewportWidth = window.innerWidth / gameState.camera.zoom;
            const viewportHeight = window.innerHeight / gameState.camera.zoom;

            const minimapX = (-gameState.camera.x / gameState.camera.zoom) * scaleX;
            const minimapY = (-gameState.camera.y / gameState.camera.zoom) * scaleY;
            const minimapW = viewportWidth * scaleX;
            const minimapH = viewportHeight * scaleY;

            minimapViewport.style.left = `${minimapX}px`;
            minimapViewport.style.top = `${minimapY}px`;
            minimapViewport.style.width = `${minimapW}px`;
            minimapViewport.style.height = `${minimapH}px`;
        }

        // ============================================
        // SISTEMA DE ZONAS
        // ============================================

        function openZoneModal(zoneId) {
            const zoneData = ZONES_DATA[zoneId];
            gameState.currentZone = zoneId;

            document.getElementById('modalIcon').textContent = zoneData.icon;
            document.getElementById('modalTitle').textContent = zoneData.name;
            document.getElementById('modalDescription').textContent = zoneData.description;

            zoneModal.classList.add('active');
        }

        function closeZoneModal() {
            zoneModal.classList.remove('active');
            gameState.currentZone = null;
        }

        function enterCurrentZone() {
            if (!gameState.currentZone) return;

            const zoneData = ZONES_DATA[gameState.currentZone];

            // Ejecutar acci√≥n de la zona
            switch(zoneData.action) {
                case 'openShop':
                    alert('üè™ Abriendo tienda de Cabanillas...\n(Esta funcionalidad se implementar√° pr√≥ximamente)');
                    break;
                case 'openCropArea':
                    alert('üåæ Accediendo al √°rea de cultivo...\n(Aqu√≠ podr√°s plantar y gestionar tus cultivos)');
                    break;
                case 'openStorage':
                    alert('üì¶ Abriendo almac√©n...\n(Gestiona tu inventario y cosechas aqu√≠)');
                    break;
                case 'openHouse':
                    alert('üè† Entrando a tu casa...\n(Mejora tus habilidades y descansa)');
                    break;
            }

            closeZoneModal();
        }

        // ============================================
        // TOOLTIPS
        // ============================================

        function showTooltip(e, text) {
            tooltip.textContent = text;
            tooltip.style.display = 'block';
            updateTooltipPosition(e);
        }

        function hideTooltip() {
            tooltip.style.display = 'none';
        }

        function updateTooltipPosition(e) {
            const x = e.clientX + 15;
            const y = e.clientY + 15;

            // Asegurar que el tooltip no se salga de la pantalla
            const rect = tooltip.getBoundingClientRect();
            const maxX = window.innerWidth - rect.width - 10;
            const maxY = window.innerHeight - rect.height - 10;

            tooltip.style.left = `${Math.min(x, maxX)}px`;
            tooltip.style.top = `${Math.min(y, maxY)}px`;
        }

        // ============================================
        // DETECCI√ìN DE ZONA
        // ============================================

        function checkCurrentLocation() {
            const centerX = -gameState.camera.x / gameState.camera.zoom + window.innerWidth / (2 * gameState.camera.zoom);
            const centerY = -gameState.camera.y / gameState.camera.zoom + window.innerHeight / (2 * gameState.camera.zoom);

            const zones = document.querySelectorAll('.zone');
            let foundZone = null;

            zones.forEach(zone => {
                const zoneX = parseFloat(zone.style.left);
                const zoneY = parseFloat(zone.style.top);
                const zoneW = parseFloat(zone.style.width);
                const zoneH = parseFloat(zone.style.height);

                if (centerX >= zoneX && centerX <= zoneX + zoneW &&
                    centerY >= zoneY && centerY <= zoneY + zoneH) {
                    foundZone = ZONES_DATA[zone.dataset.zone];
                }
            });

            if (foundZone) {
                locationText.textContent = `Cerca de: ${foundZone.name}`;
            } else {
                locationText.textContent = 'Explorando Cabanillas...';
            }
        }

        // ============================================
        // GAME LOOP
        // ============================================

        function startGameLoop() {
            setInterval(() => {
                handleKeyboardMovement();
                checkCurrentLocation();
            }, 16); // ~60 FPS
        }

        console.log('üó∫Ô∏è ¬°Mapa de Cabanillas cargado exitosamente! üó∫Ô∏è');
        console.log('üìê Dimensiones: ' + WORLD_WIDTH + 'x' + WORLD_HEIGHT + ' p√≠xeles');
    </script>
</body>
</html>
